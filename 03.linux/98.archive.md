# 98 | 历史命令存档（高注释保留）

本文件为 Linux 模块中的**记忆仓库**，用于收录你曾使用但已逐渐遗忘的命令、特殊用法、场景性强的操作流程。它们可能已被新工具替代，但**代表了特定问题的解决路径与当时思维逻辑**。

> ⚠️ 注：本文件的命令大多数不再日常使用，但每一条注释都可能是找回上下文的钥匙。请保留所有注释！

---

## 🧨 启动级服务（SysV-init 旧系统）

```bash
service nginx start                   # 在 CentOS 6 及更早版本中使用
chkconfig nginx on                    # 设置服务开机自启（旧）
```

---

## 🧵 经典 Bash trick

```bash
!!                                     # 重复上一条命令
!vim                                   # 重复上一次以 vim 开头的命令
df -h | grep -v tmpfs                  # 查看磁盘，排除虚拟挂载（CI 上用于判断部署空间）
```

---

## 🗂️ 归档与解压命令（老项目打包流程）

```bash
tar -czvf code.tar.gz ./project       # 压缩当前目录
tar -xzvf code.tar.gz                 # 解压（曾用于历史项目备份）
zip -r archive.zip ./docs             # 打 zip 包
```

---

## 🧠 特定问题排查记录（极具场景性）

```bash
lsof | grep deleted                   # 查找被删除但仍占用空间的进程文件（清理磁盘）
find / -type s                        # 查找所有 socket 文件（排查 php-fpm 丢失 .sock 问题）
strace -p <pid>                       # 跟踪进程系统调用（排查卡顿）
```

---

## 🧰 超老旧项目初始化脚本片段（保留意义）

```bash
export LC_ALL=C                     # 避免 grep、sort 报 locale 错误
alias grep='grep --color=auto'      # 为了排查时更直观（早期 bashrc 默认没有）
export HISTTIMEFORMAT="%F %T "      # 历史命令带时间戳
```

---

## 🧙 曾踩过坑的命令

```bash
chmod 777 -R /                       # ⚠️ 曾误操作导致系统权限错乱（回滚系统）
rm -rf ./ --no-preserve-root         # ⚠️ 保留警示用途，永不执行！
```

---

## 🧠 历史注释说明

- `chkconfig`、`service` 用于早期 CentOS 5/6 时期部署脚本
- `strace` 是处理程序挂死时**最后的核弹**工具
- `export LC_ALL=C` 解决过某些 grep 中文乱码或乱序的问题
- `grep deleted` 曾救过挂死磁盘的线下服务器（docker log 占满磁盘）
- `rm -rf ./ --no-preserve-root` 曾被某实习误操作，写入文档作为反例警告

---

> 📁 本文件建议归档于 `linux/legacy/` 或 `linux/archives/`，作为命令仓库 & 学习资料长期维护。
