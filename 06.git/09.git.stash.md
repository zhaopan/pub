# Git Stash

git stash 栈空间是开发者进行上下文切换的核心工具。在处理高并发交易系统等复杂逻辑时，灵活运用 stash 可以极大提升代码提交的原子性。

## 1. 常用核心操作

### 精细化入栈
- 基础入栈：git stash push -m "description"
- 包含未跟踪文件：git stash -u (处理新创建的 Golang 源文件时必用)
- 包含忽略文件：git stash -a (通常用于临时修改了本地环境配置的情况)

### 交互式入栈 (Patch 模式)
- 挑选修改：git stash -p
- 说明：此命令会进入交互界面，允许你逐个确认代码块（Hunks）。这对于只想暂存部分调试代码，而保留业务逻辑进行提交的场景非常有用。

### 状态查看与校验
- 简要列表：git stash list
- 查看详情：git stash show -p stash@{0} (查看暂存内容与当前分支的差异详情)
- 仅查看文件列表：git stash show stash@{0}

---

## 2. 高阶管理技巧

### 弹出逻辑的选择
- 应用并删除：git stash pop (默认行为，适用于单次恢复)
- 仅应用保留：git stash apply (在多个分支之间同步同一份临时修改时极其有用)
- 强制删除：git stash drop stash@{0}

### 从暂存区直接创建分支
- 场景：当你发现暂存的代码量过大，且与当前分支方向偏离时。
- 命令：git stash branch <new_branch_name> stash@{0}
- 效果：Git 会基于暂存发生时的那个提交点创建一个新分支，并把暂存内容应用上去。成功后会自动删除该 stash 记录。

### 暂存特定路径
- 场景：只想暂存某个特定的模块代码，例如只暂存 ./internal/trading 目录。
- 命令：git stash push -m "only trading logic" ./internal/trading

---

## 3. 架构师级工作流

### 配合 Rebase 保持线性历史
- 逻辑：在执行 git pull --rebase 之前，先 git stash。
- 流程：
  - git stash
  - git pull --rebase origin main
  - git stash pop
- 价值：避免了不必要的 Merge Commit，保持了交易系统代码库的提交历史清晰。

### 临时热修复场景
- 逻辑：正在 develop 开发中，main 需要紧急修复。
- 流程：
  - git stash (保存当前进度)
  - git checkout main
  - git checkout -b hotfix/api-leak
  - (修复并 commit)
  - git checkout develop
  - git stash pop (回到之前的开发状态)

---

## 4. 维护与防丢建议

- 命名规范：永远不要使用不带备注的 git stash。对于架构师来说，stash@{5} 这种默认命名是不可维护的。
- 冲突保护：如果 pop 时产生冲突，Git 不会自动删除 stash。必须手动修复冲突并 add 后，再手动执行 git stash drop。
- 定期清理：使用 git stash clear 之前务必确认 stash list 为空。





# Git Stash 技术部标准作业程序 (SOP)

本文档定义了在 Synapse.X 系统开发过程中处理上下文切换的标准方式，旨在通过原子化操作确保 master 分支的绝对纯净。

## 一. 核心使用场景

### 1. 优先级调度 (Context Switch)
- 场景：正在开发 Synapse.Service 的撮合逻辑，需立即切换到 Synapse.WinApp 修复紧急 UI Bug。
- 操作：
  - git stash push -u -m "WORK: 撮合引擎优化-未完"
  - git checkout main
  - (修复并提交)
  - git checkout -
  - git stash pop
- 价值：确保修复 Bug 的代码不会混入未完成的实验性特性。

### 2. 代码重构与清洗 (Dirty Code Filter)
- 场景：在开发中为了调试，在代码中加入了大量的调试 log 和临时 Mock 逻辑。
- 操作：
  - git stash -p
  - 交互选择：将所有调试代码通过 y 放入暂存，将业务逻辑留在工作区。
  - git commit -m "feat: 业务功能实现"
  - git stash drop
- 价值：防止调试用的垃圾代码误入代码库。

### 3. 安全同步 (Pre-Rebase)
- 场景：准备推送代码，但远程分支已有更新。
- 操作：
  - git stash
  - git pull --rebase
  - git stash pop
- 价值：强制维持线性提交历史，避免在交易系统中产生冗余的 Merge 节点。

---

## 二. 进阶指令矩阵

- 暂存特定路径：git stash push ./Synapse.Service/
- 预览暂存内容：git stash show -p stash@{0}
- 应用但不删除：git stash apply stash@{0} (常用于多分支灰度测试)
- 分支化处理：git stash branch feature/refactor stash@{0} (当 Stash 内容过多无法直接 Pop 时使用)

---

## 三. 架构师级规范 (SSOP)

- 描述规范：禁止使用无备注的暂存。备注必须描述“当前进度的具体状态”。
- 物理清理：定期执行 git stash list。超过 5 条记录必须进行合并或删除，防止堆栈爆炸。
- 冲突处理：pop 产生冲突后，记录会保留在栈中。必须手动 fix 后显式执行 git stash drop。
- 排除规则：确保 .gitignore 配置完善，避免将 node_modules 或编译生成的二进制文件推入 Stash。

---

## 四. 团队效率 Alias

在 ~/.gitconfig 中配置，确保全员统一：
- [alias]
- st = stash push -u -m
- sl = stash list
- sp = stash pop
- sd = stash drop
