# 05 | Docker 常见问题排查与实战建议

本模块汇总开发过程中使用 Docker 时的典型问题与排查方法，覆盖容器运行、网络连接、数据卷挂载、镜像构建等多个环节，旨在提升故障定位与快速修复能力。

---

## 🧱 容器运行类问题

### ❌ 容器启动后立即退出

- **现象**：`docker ps -a` 中状态为 Exited
- **原因分析**：
  - CMD/ENTRYPOINT 执行完毕即退出（如运行 `echo`）
- **解决建议**：
  - 改为长期运行进程，如 `tail -f /dev/null` 或守护型应用

---

### ❌ 无法进入容器交互终端

- **命令报错**：`docker exec` 或 `docker attach` 无反应
- **排查建议**：
  - 确认容器处于运行状态：`docker ps`
  - 使用 `-it` 参数确保交互终端分配

---

## 🌐 网络访问类问题

### ❌ 外部访问容器服务失败

- **排查路径**：
  1. 容器是否暴露端口：`EXPOSE` + `-p` 参数
  2. 主机端口是否被监听：`netstat -tunlp`
  3. 防火墙/安全组策略限制？

---

### ❌ 容器间无法通信

- **默认 bridge 网络不支持 DNS 解析**
- 推荐做法：
  - 使用自定义网络：`docker network create`
  - 通过容器名称互通通信

---

## 📦 数据卷与文件挂载问题

### ❌ 配置挂载后容器启动失败

- **常见原因**：
  - 本地路径不存在或权限不足
- **解决方法**：
  - 确保挂载目录存在（`mkdir -p`）
  - 临时测试赋权：`chmod -R 777 ./data`

---

### ❌ 挂载文件修改不生效

- **原因分析**：
  - 文件已缓存于容器内，未热更新
- **建议操作**：
  - 重启容器：`docker restart <name>`
  - 确保本地文件改动确实映射到容器中

---

## 🔨 镜像构建相关问题

### ❌ 镜像构建失败 / 无缓存效果

- **优化建议**：
  - 精准使用 `.dockerignore` 排除无关内容
  - 合理拆分 Dockerfile，利用缓存层

---

### ❌ 容器镜像过大

- **优化建议**：
  - 使用精简基础镜像（如 `alpine`）
  - 多阶段构建剥离编译产物

---

## 🧠 建议实践习惯

- 使用 `docker logs` 定位容器错误
- 所有 `docker run` 命令写成 script 便于重现
- `docker inspect` 深入查看网络、挂载等状态
- 使用 `watch docker stats` 监控容器资源使用情况

---

## 📘 参考命令速查

```bash
docker ps -a                  # 查看容器状态
docker logs <name>            # 查看容器日志
docker exec -it <name> bash   # 进入容器交互终端
docker network inspect <net>  # 查看网络详情
docker volume ls              # 查看所有卷
```

---

> 📁 至此，Docker 核心基础模块整理完毕，推荐结合日常实战持续更新场景案例。
