# 02 | docker-compose.yml æ–‡ä»¶ç»“æ„ä¸å­—æ®µè¯¦è§£

æœ¬æ¨¡å—æ·±å…¥è§£æ `docker-compose.yml` æ–‡ä»¶çš„ç»“æ„ç»„æˆä¸æ ¸å¿ƒé…ç½®å­—æ®µï¼Œå¸®åŠ©å¼€å‘è€…ç†è§£ Compose å¦‚ä½•å®ŒæˆæœåŠ¡å®šä¹‰ã€ç½‘ç»œç»‘å®šã€æŒ‚è½½é…ç½®ã€ç¯å¢ƒå˜é‡ä¼ é€’ç­‰ä¸€ç³»åˆ—å®¹å™¨ç¼–æ’ä»»åŠ¡ã€‚

---

## ğŸ“Œ ä½¿ç”¨åœºæ™¯

- ç†è§£æ¯ä¸ªå­—æ®µçš„ä½œç”¨åŠå¸¸è§ç”¨æ³•
- å¯¹å¤æ‚æœåŠ¡è¿›è¡Œæ¸…æ™°çš„ YAML ç¼–æ’
- ä½œä¸ºå›¢é˜Ÿåä½œã€è‡ªåŠ¨åŒ–éƒ¨ç½²çš„é…ç½®åŸºç¡€

---

## ğŸ¯ ç›®æ ‡

- æŒæ¡ Compose YAML æ–‡ä»¶çš„é€šç”¨ç»“æ„
- ç†Ÿæ‚‰å¸¸ç”¨å­—æ®µå¦‚ `services`ã€`volumes`ã€`networks`ã€`build` ç­‰
- ç†è§£é…ç½®ä¼˜å…ˆçº§ã€å˜é‡æ³¨å…¥ä¸ç»“æ„åµŒå¥—è§„åˆ™

---

## ğŸ“˜ æ–‡ä»¶ç»“æ„æ¦‚è§ˆ

```yaml
version: "3.8"

services:
  web:
    image: nginx:latest
    ports:
      - "8080:80"
    volumes:
      - ./html:/usr/share/nginx/html
    environment:
      - NGINX_HOST=localhost
    depends_on:
      - db

  db:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: 123456

volumes:
  db-data:

networks:
  default:
```

---

## ğŸ” å­—æ®µè¯´æ˜è¯¦è§£

### âœ… `version`

æŒ‡å®š Compose æ–‡ä»¶ç‰ˆæœ¬ï¼Œå»ºè®®ä½¿ç”¨ `"3.8"` ä»¥ä¿æŒæœ€æ–°å…¼å®¹æ€§ã€‚

### âœ… `services`

å®šä¹‰å…·ä½“è¿è¡Œçš„å®¹å™¨æœåŠ¡ã€‚æ¯ä¸€ä¸ª service å¯¹åº”ä¸€ä¸ªå®¹å™¨ï¼Œå¯ä»¥é…ç½®é•œåƒã€ç«¯å£ã€ä¾èµ–ã€æŒ‚è½½ç­‰ã€‚

å¸¸è§å­—æ®µè¯´æ˜ï¼š

| å­—æ®µ          | è¯´æ˜                          |
| ------------- | ----------------------------- |
| `image`       | ä½¿ç”¨çš„é•œåƒå                  |
| `build`       | æŒ‡å®š Dockerfile æ„å»ºè·¯å¾„      |
| `ports`       | æ˜ å°„å®¹å™¨ç«¯å£                  |
| `volumes`     | æ•°æ®å·æŒ‚è½½é…ç½®                |
| `environment` | ç¯å¢ƒå˜é‡æ³¨å…¥                  |
| `depends_on`  | å¯åŠ¨é¡ºåºä¾èµ–ï¼ˆéå¥åº·æ£€æŸ¥ï¼‰    |
| `command`     | å®¹å™¨å¯åŠ¨æ‰§è¡Œå‘½ä»¤              |
| `restart`     | å®¹å™¨è‡ªåŠ¨é‡å¯ç­–ç•¥ï¼ˆå¦‚ alwaysï¼‰ |

---

### âœ… `volumes`

å®šä¹‰å‘½åå·ï¼Œé€šå¸¸ç”¨äºæ•°æ®æŒä¹…åŒ–ï¼š

```yaml
volumes:
  db-data:
```

ä¹Ÿå¯åœ¨æœåŠ¡ä¸­æŒ‚è½½è·¯å¾„ï¼š

```yaml
volumes:
  - db-data:/var/lib/mysql
```

---

### âœ… `networks`

å®šä¹‰æœåŠ¡ä½¿ç”¨çš„è‡ªå®šä¹‰ç½‘ç»œï¼Œæå‡å®‰å…¨æ€§ä¸éš”ç¦»æ€§ï¼š

```yaml
networks:
  frontend:
  backend:
```

æœåŠ¡ä¸­æŒ‡å®šï¼š

```yaml
networks:
  - backend
```

---

### âœ… `.env` é…åˆä½¿ç”¨

å¯ä»¥é€šè¿‡ `.env` æ–‡ä»¶æ³¨å…¥å˜é‡ï¼š

```env
MYSQL_ROOT_PASSWORD=123456
APP_ENV=development
```

åœ¨ YAML ä¸­ä½¿ç”¨ï¼š

```yaml
environment:
  - MYSQL_ROOT_PASSWORD=${MYSQL_ROOT_PASSWORD}
```

---

## ğŸ§ª éªŒè¯æ–¹å¼

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤éªŒè¯é…ç½®æ˜¯å¦æ­£ç¡®ï¼š

```bash
docker-compose config
```

> è¯¥å‘½ä»¤ä¼šè¾“å‡ºè§£æåçš„ Compose é…ç½®ï¼Œå¯ç”¨äºæ£€æŸ¥è¯­æ³•ã€å˜é‡å¼•ç”¨ã€è·¯å¾„æ˜¯å¦æ­£ç¡®ã€‚

---

## ğŸš¨ å¸¸è§é—®é¢˜æ’æŸ¥

| é—®é¢˜æè¿°                    | æ’æŸ¥å»ºè®®                                        |
| --------------------------- | ----------------------------------------------- |
| YAML æŠ¥é”™                   | æ³¨æ„ç¼©è¿›ï¼ˆå»ºè®®ä½¿ç”¨ç©ºæ ¼æ›¿ä»£ Tabï¼‰                |
| ç¯å¢ƒå˜é‡æœªç”Ÿæ•ˆ              | ç¡®è®¤ `.env` æ–‡ä»¶å­˜åœ¨ä¸”å˜é‡åæ­£ç¡®                |
| depends_on æ— æ³•æ§åˆ¶å¥åº·çŠ¶æ€ | éœ€å¦è¡Œå®ç°å¥åº·æ£€æŸ¥é€»è¾‘æˆ–ä½¿ç”¨ `wait-for-it` è„šæœ¬ |

---

## ğŸ§  æ‹“å±•çŸ¥è¯†ç‚¹

- å¤š Compose æ–‡ä»¶åˆå¹¶ï¼š`docker-compose -f base.yml -f override.yml up`
- ä½¿ç”¨ `profiles` æ§åˆ¶æœåŠ¡æ¿€æ´»ï¼ˆv3.9+ï¼‰
- å¯å°† Compose æ–‡ä»¶åµŒå…¥ CI/CD æµæ°´çº¿ä¸­ç»Ÿä¸€éƒ¨ç½²ç®¡ç†

---

> ğŸ“ ä¸‹ä¸€æ¨¡å—ï¼šç¯å¢ƒå˜é‡ä¸é…ç½®è¦†ç›– â†’ [03-env-override.md](./03-env-override.md)
