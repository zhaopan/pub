# 03 | ç¯å¢ƒå˜é‡ä¸é…ç½®è¦†ç›–æœºåˆ¶

æœ¬æ¨¡å—ä»‹ç» Docker Compose ä¸­ `.env` æ–‡ä»¶ã€ç¯å¢ƒå˜é‡æ³¨å…¥ã€é…ç½®è¦†ç›–æ–‡ä»¶ï¼ˆ`override.yml`ï¼‰çš„ä½¿ç”¨æ–¹æ³•ï¼Œå¸®åŠ©å®ç°çµæ´»çš„å¤šç¯å¢ƒé…ç½®èƒ½åŠ›ï¼Œæ»¡è¶³å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç­‰ä¸åŒåœºæ™¯éœ€æ±‚ã€‚

---

## ğŸ“Œ ä½¿ç”¨åœºæ™¯

- åŒä¸€å¥— Compose é…ç½®ï¼Œåœ¨ä¸åŒç¯å¢ƒä¸­ä½¿ç”¨ä¸åŒç«¯å£ã€å¯†ç ã€é•œåƒæ ‡ç­¾
- å¸Œæœ›å°†é…ç½®æŠ½ç¦»å‡ºä»£ç é€»è¾‘ï¼Œå®ç°â€œé…ç½®å³éƒ¨ç½²â€
- åœ¨ CI/CD æµæ°´çº¿ä¸­åŠ¨æ€æ³¨å…¥ç¯å¢ƒå˜é‡ä¸è¦†ç›–ç­–ç•¥

---

## ğŸ¯ ç›®æ ‡

- ä½¿ç”¨ `.env` ç®¡ç†é»˜è®¤ç¯å¢ƒå˜é‡
- åœ¨ Compose æ–‡ä»¶ä¸­åŠ¨æ€å¼•ç”¨å˜é‡
- ä½¿ç”¨ `docker-compose.override.yml` å®ç°é…ç½®è¦†ç›–
- äº†è§£å˜é‡ä¼˜å…ˆçº§ä¸ä½œç”¨åŸŸ

---

## ğŸ“¦ ç¤ºä¾‹ 1ï¼šä½¿ç”¨ `.env` æ³¨å…¥å˜é‡

### ğŸ“ æ–‡ä»¶ç»“æ„

```yaml
myapp/
â”œâ”€â”€ docker-compose.yml
â””â”€â”€ .env
```

### ğŸ“ .env æ–‡ä»¶ç¤ºä¾‹

```env
NGINX_PORT=8080
MYSQL_ROOT_PASSWORD=123456
APP_ENV=development
```

### ğŸ“ docker-compose.yml ç¤ºä¾‹

```yaml
version: "3.8"

services:
  web:
    image: nginx
    ports:
      - "${NGINX_PORT}:80"

  db:
    image: mysql
    environment:
      - MYSQL_ROOT_PASSWORD=${MYSQL_ROOT_PASSWORD}
```

---

## ğŸ“¦ ç¤ºä¾‹ 2ï¼šä½¿ç”¨ override æ–‡ä»¶è¦†ç›–é…ç½®

Compose é»˜è®¤ä¼šè‡ªåŠ¨åˆå¹¶åŒç›®å½•ä¸‹çš„ `docker-compose.override.yml`ï¼Œç”¨äºåœ¨ä¸åŒç¯å¢ƒä¸‹å±€éƒ¨è¦†ç›–é…ç½®é¡¹ã€‚

### ğŸ“ docker-compose.override.yml ç¤ºä¾‹

```yaml
services:
  web:
    ports:
      - "3000:80"
    environment:
      - DEBUG=true
```

### å¯åŠ¨å‘½ä»¤ï¼ˆè‡ªåŠ¨åˆå¹¶ï¼‰

```bash
docker-compose up -d
```

### è‡ªå®šä¹‰å¤šä¸ªè¦†ç›–æ–‡ä»¶

```bash
docker-compose -f docker-compose.yml -f docker-compose.prod.yml up -d
```

---

## ğŸ”„ å˜é‡ä¼˜å…ˆçº§ï¼ˆä»é«˜åˆ°ä½ï¼‰

1. CLI å‘½ä»¤ä¸­æ˜¾å¼å®šä¹‰çš„å˜é‡ï¼ˆå¦‚ `MY_VAR=value docker-compose up`ï¼‰
2. shell ä¸­å·²æœ‰çš„ç¯å¢ƒå˜é‡
3. `.env` æ–‡ä»¶ä¸­çš„å˜é‡
4. Compose æ–‡ä»¶ä¸­é»˜è®¤å€¼ï¼ˆ`${VAR:-default}`ï¼‰

---

## ğŸ§ª éªŒè¯æ–¹å¼

æŸ¥çœ‹å˜é‡æ˜¯å¦è¢«æ­£ç¡®è§£æï¼š

```bash
docker-compose config
```

å¯è¾“å‡ºå®Œæ•´å±•å¼€åçš„ Compose é…ç½®å†…å®¹ã€‚

---

## ğŸš¨ å¸¸è§é—®é¢˜æ’æŸ¥

| é—®é¢˜æè¿°   | æ’æŸ¥å»ºè®®                                            |
| ---------- | --------------------------------------------------- |
| å˜é‡æœªç”Ÿæ•ˆ | æ£€æŸ¥ `.env` æ–‡ä»¶æ˜¯å¦åœ¨ Compose æ–‡ä»¶åŒç›®å½•           |
| å˜é‡ä¸ºç©º   | ä½¿ç”¨é»˜è®¤å€¼è¯­æ³•ï¼š`${VAR:-default}`                   |
| è¦†ç›–æœªç”Ÿæ•ˆ | è¦†ç›–æ–‡ä»¶å­—æ®µéœ€ç»“æ„ä¸€è‡´æ‰ä¼šç”Ÿæ•ˆï¼ˆå¦‚ `ports` ä¸ºæ•°ç»„ï¼‰ |

---

## ğŸ§  æ‹“å±•çŸ¥è¯†ç‚¹

- å°†å¤šä¸ª `.env` æ–‡ä»¶æŒ‰ç¯å¢ƒå‘½åï¼š`.env.dev`ã€`.env.prod`
- ä½¿ç”¨ `--env-file` æ˜ç¡®æŒ‡å®šåŠ è½½é…ç½®
- é…åˆ CI å·¥å…·åŠ¨æ€æ¸²æŸ“ env æ–‡ä»¶ï¼ˆå¦‚ GitHub Actions secretsï¼‰

---

> ğŸ“ ä¸‹ä¸€æ¨¡å—ï¼šCompose æœ€ä½³å®è·µä¸é—®é¢˜æ’æŸ¥ â†’ [04-best-practices.md](./04-best-practices.md)
